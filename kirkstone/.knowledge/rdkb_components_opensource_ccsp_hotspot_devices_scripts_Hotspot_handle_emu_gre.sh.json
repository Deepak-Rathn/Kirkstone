{"is_source_file": true, "format": "Shell script (sh)", "description": "This file is a shell script used for configuring GRE tunnels and network interfaces related to a hotspot device, including creating GRE tunnels, setting system events, and managing bridge interfaces.", "external_files": ["/nvram/hostapd0.conf", "/nvram/hostapd4.conf", "/nvram/hostapd5.conf", "/bin/cat", "/usr/sbin/psmcli", "/sbin/ifconfig", "/usr/sbin/bridge", "/sbin/brctl", "/sbin/vconfig", "/sbin/iptables"], "external_methods": ["sysevent set", "psmcli nosubsys get", "cat", "grep", "cut", "tr", "ip link set", "ip link add", "brctl addbr", "ifconfig", "sleep", "vconfig add", "iptables"], "published": [], "classes": [], "methods": [{"name": "init_snooper_sysevents", "description": "Initializes sys events for snooper logs by enabling circuit and remote snooper functions."}, {"name": "read_init_params", "description": "Retrieves initial parameters from PSM database for GRE tunnel configuration."}, {"name": "create_tunnel", "description": "Creates a GRE tunnel, sets up network interfaces, and adds interfaces to bridge groups."}, {"name": "init_keepalive_sysevents", "description": "Initializes sys events related to keepalive settings for the hotspot."}, {"name": "update_bridge_config", "description": "Configures iptables rules for forwarding and NFQUEUE filtering."}], "calls": ["sysevent set snooper-circuit-enable 1", "sysevent set snooper-remote-enable 1", "psmcli nosubsys get -e PRIMARY ...", "ip link set dev $GRE_IFNAME name $GRE_IFNAME_DUMMY", "ip link add gretap0 type gretap remote `sysevent get hotspotfd-tunnelEP` local ...", "brctl addbr brlan1", "brctl addbr brlan2", "ifconfig gretap0 up", "vconfig add gretap0 100", "vconfig add gretap0 101", "ifconfig gretap0.100 up", "ifconfig gretap0.101 up", "brctl addif brlan1 $INTERFACE_2G", "brctl addif brlan1 gretap0.100", "brctl addif brlan2 $INTERFACE_5G", "brctl addif brlan2 gretap0.101", "sysevent set hotspotfd-primary $PRIMARY", "sysevent set hotspotfd-secondary $SECONDARY", "sysevent set hotspotfd-threshold $KA_THRESH", "sysevent set hotspotfd-keep-alive $KA_INTERVAL", "sysevent set hotspotfd-max-secondary $KA_RECON_PRIM", "sysevent set hotspotfd-policy $KA_POLICY", "sysevent set hotspotfd-count $KA_COUNT", "sysevent set hotspotfd-dead-interval $KA_FAIL_INTERVAL", "sysevent set hotspotfd-enable 1", "sysevent set hotspotfd-log-enable 1", "iptables -I FORWARD -j general_forward", "iptables -I OUTPUT -j general_output", "iptables -I general_forward -o brlan1 -p udp --dport=67:68 -j NFQUEUE --queue-bypass --queue-num 1", "iptables -A general_forward -o brlan2 -p udp --dport=67:68 -j NFQUEUE --queue-bypass --queue-num 2", "iptables -A general_output -o eth0 -p icmp --icmp-type 3 -j NFQUEUE --queue-bypass --queue-num 0"], "search-terms": ["gretap", "GRE tunnel", "hotspot sys events", "PSM configuration", "bridge setup", "network interfaces", "NFQUEUE rules", "create_tunnel", "handle_emu_gre.sh"], "state": 2, "file_id": 9779, "knowledge_revision": 22792, "git_revision": "", "hash": "9cd398013c8d9dbc4b9209fc35d90811", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "rdkb/components/opensource/ccsp/hotspot/devices/scripts/Hotspot/handle_emu_gre.sh", "revision_history": [{"22792": ""}]}