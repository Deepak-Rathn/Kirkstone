{"is_source_file": true, "format": "Python", "description": "This file defines a Python class 'QemuRunner' that provides functionality for managing QEMU virtual machines, including starting, stopping, configuration, and logging. It also includes a 'LoggingThread' class for asynchronous socket logging, and accomplishes VM control via subprocesses, sockets, and QEMU monitor protocol.", "external_files": ["oeqa/utils/dump.py", "qmp.py"], "external_methods": ["importlib.invalidate_caches", "importlib.import_module"], "published": ["QemuRunner"], "classes": [{"name": "QemuRunner", "description": "Class for managing QEMU VM lifecycle, interaction, and logging."}, {"name": "LoggingThread", "description": "Thread class for asynchronous logging of socket data."}], "methods": [{"name": "__init__(self, logfunc, sock, logger)", "description": "Constructor for setting up QemuRunner with configuration parameters.", "scope": "LoggingThread", "scopeKind": "class"}, {"name": "create_socket(self)", "description": "Creates a non-blocking listening socket for serial console.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "log(self, msg)", "description": "Logs messages to logfile with sanitization.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "getOutput(self, o)", "description": "Reads data non-blockingly from a file descriptor.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "handleSIGCHLD(self, signum, frame)", "description": "Signal handler to detect when runqemu process exits.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "start(self, qemuparams = None, get_ip = True, extra_bootparams = None, runqemuparams='', launch_cmd=None, discard_writes=True)", "description": "Starts a QEMU VM with specified parameters.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "launch(self, launch_cmd, get_ip = True, qemuparams = None, extra_bootparams = None, env = None)", "description": "Internal method to launch QEMU subprocess with monitoring and setup.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "stop(self)", "description": "Stops the QEMU process and cleans up resources.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "stop_qemu_system(self)", "description": "Sends SIGTERM to QEMU process ID.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "stop_thread(self)", "description": "Stops logging threads.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "allowexit(self)", "description": "Allows thread to exit on connection closure.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "restart(self, qemuparams = None)", "description": "Restarts the QEMU VM.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "is_alive(self)", "description": "Checks if the QEMU process is running.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "run_monitor(self, command, args=None, timeout=60)", "description": "Sends commands via QEMU monitor protocol.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "run_serial(self, command, raw=False, timeout=60)", "description": "Sends commands on the serial console and collects output.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "_dump_host(self)", "description": "Triggers host dump in case of unexpected termination.", "scope": "QemuRunner", "scopeKind": "class"}, {"name": "__init__(self, machine, rootfs, display, tmpdir, deploy_dir_image, logfile, boottime, dump_dir, dump_host_cmds, use_kvm, logger, use_slirp=False, serial_ports=2, boot_patterns = defaultdict(str), use_ovmf=False, workdir=None, tmpfsdir=None)", "scope": "QemuRunner", "scopeKind": "class", "description": "unavailable"}, {"name": "close_ignore_error(self, fd)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "close_socket(self, sock)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "eventloop(self)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "recv(self, count)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "run(self)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "stringify_event(self, event)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "tail(l)", "scope": "QemuRunner.launch", "scopeKind": "member", "description": "unavailable"}, {"name": "teardown(self)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}, {"name": "threadtarget(self)", "scope": "LoggingThread", "scopeKind": "class", "description": "unavailable"}], "calls": ["subprocess.Popen", "os.readlink", "os.read", "signal.signal", "signal.getsignal", "signal.kill", "select.select", "select.poll", "socket.socket", "time.time", "re.findall", "re.search", "os.kill", "os.close", "os.unlink", "os.killpg", "os.path.exists", "os.path.isfile", "os.readlink", "ps.communicate", "importlib.import_module"], "search-terms": ["QemuRunner", "qmp", "runqemu", "qemupid", "monitor", "serial", "logging thread", "VM lifecycle", "QEMU monitor protocol", "lib/oeqa/utils/dump.py"], "state": 2, "file_id": 1874, "knowledge_revision": 15018, "git_revision": "", "ctags": [{"_type": "tag", "name": "LoggingThread", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^class LoggingThread(threading.Thread):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "QemuRunner", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^class QemuRunner:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def __init__(self, logfunc, sock, logger):$/", "language": "Python", "kind": "member", "signature": "(self, logfunc, sock, logger)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def __init__(self, machine, rootfs, display, tmpdir, deploy_dir_image, logfile, boottime, du/", "language": "Python", "kind": "member", "signature": "(self, machine, rootfs, display, tmpdir, deploy_dir_image, logfile, boottime, dump_dir, dump_host_cmds, use_kvm, logger, use_slirp=False, serial_ports=2, boot_patterns = defaultdict(str), use_ovmf=False, workdir=None, tmpfsdir=None)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "_dump_host", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def _dump_host(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "allowexit", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def allowexit(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "allowexit", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def allowexit(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "close_ignore_error", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def close_ignore_error(self, fd):$/", "language": "Python", "kind": "member", "signature": "(self, fd)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "close_socket", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def close_socket(self, sock):$/", "language": "Python", "kind": "member", "signature": "(self, sock)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "control_chars", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^control_chars = [chr(x) for x in control_range$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "control_range", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^control_range = list(range(0,32))+list(range(127,160))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_socket", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def create_socket(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "eventloop", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def eventloop(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "getOutput", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def getOutput(self, o):$/", "language": "Python", "kind": "member", "signature": "(self, o)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "handleSIGCHLD", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def handleSIGCHLD(self, signum, frame):$/", "language": "Python", "kind": "member", "signature": "(self, signum, frame)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "is_alive", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def is_alive(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "launch", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def launch(self, launch_cmd, get_ip = True, qemuparams = None, extra_bootparams = None, env /", "language": "Python", "kind": "member", "signature": "(self, launch_cmd, get_ip = True, qemuparams = None, extra_bootparams = None, env = None)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "log", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def log(self, msg):$/", "language": "Python", "kind": "member", "signature": "(self, msg)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "re_control_char", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^re_control_char = re.compile('[%s]' % re.escape(\"\".join(control_chars)))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "recv", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def recv(self, count):$/", "language": "Python", "kind": "member", "signature": "(self, count)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "restart", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def restart(self, qemuparams = None):$/", "language": "Python", "kind": "member", "signature": "(self, qemuparams = None)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "run", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def run(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "run_monitor", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def run_monitor(self, command, args=None, timeout=60):$/", "language": "Python", "kind": "member", "signature": "(self, command, args=None, timeout=60)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "run_serial", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def run_serial(self, command, raw=False, timeout=60):$/", "language": "Python", "kind": "member", "signature": "(self, command, raw=False, timeout=60)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def start(self, qemuparams = None, get_ip = True, extra_bootparams = None, runqemuparams='',/", "language": "Python", "kind": "member", "signature": "(self, qemuparams = None, get_ip = True, extra_bootparams = None, runqemuparams='', launch_cmd=None, discard_writes=True)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "stop", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def stop(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "stop", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def stop(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "stop_qemu_system", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def stop_qemu_system(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "stop_thread", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def stop_thread(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "QemuRunner", "scopeKind": "class"}, {"_type": "tag", "name": "stringify_event", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def stringify_event(self, event):$/", "language": "Python", "kind": "member", "signature": "(self, event)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "tail", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^            tail = lambda l: \"\\\\n\".join(l.splitlines()[-25:])$/", "file": true, "language": "Python", "kind": "function", "signature": "(l)", "scope": "QemuRunner.launch", "scopeKind": "member"}, {"_type": "tag", "name": "teardown", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def teardown(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}, {"_type": "tag", "name": "threadtarget", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "pattern": "/^    def threadtarget(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "LoggingThread", "scopeKind": "class"}], "hash": "1c3f79d2e3ff2406a37b55ca16e61c7f", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "openembedded-core/meta/lib/oeqa/utils/qemurunner.py", "fields": [{"name": "control_chars = [chr(x) for x in control_range", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "control_range = list(range(0,32))+list(range(127,160))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "re_control_char = re.compile('[%s]' % re.escape(\"\".join(control_chars)))", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"15018": ""}]}