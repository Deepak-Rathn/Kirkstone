{"is_source_file": true, "format": "C", "description": "This source file manages device descriptor download tasks, including handling whitelist and blacklist URLs, downloading files, validating them, and updating system properties. It coordinates scheduled retries with backoff and ensures local files are up to date based on URL and MD5 comparisons.", "external_files": ["<stdlib.h>", "<string.h>", "<sys/stat.h>", "<sys/errno.h>", "<unistd.h>", "<pthread.h>", "icLog/logging.h", "propsMgr/propsHelper.h", "propsMgr/commonProperties.h", "deviceService.h", "deviceDescriptors.h", "icUtil/md5.h", "icUtil/stringUtils.h", "urlHelper/urlHelper.h", "icConcurrent/repeatingTask.h", "icUtil/fileUtils.h"], "external_methods": ["deviceServiceSetSystemProperty()", "deviceServiceGetSystemProperty()", "hasProperty()", "getPropertyAsString()", "createBackOffRepeatingTask()", "cancelRepeatingTask()", "urlHelperCancel()", "urlHelperDownloadFile()", "doesFileExist()", "readFileContents()", "icMd5sum()", "stringCompare()", "free_generic__auto"], "published": ["deviceServiceDeviceDescriptorsInit", "deviceServiceDeviceDescriptorsDestroy", "deviceDescriptorsUpdateWhitelist", "deviceDescriptorsUpdateBlacklist"], "classes": [], "methods": [{"name": "void deviceServiceDeviceDescriptorsInit(deviceDescriptorsReadyForDevicesFunc readyForDevicesCallback,deviceDescriptorsUpdatedFunc descriptorsUpdatedCallback)", "description": "Initializes device descriptor management, retrieves last known whitelist/blacklist URLs, and initiates their download.", "scope": "", "scopeKind": ""}, {"name": "void deviceServiceDeviceDescriptorsDestroy()", "description": "Cleans up resources, cancels scheduled tasks, nullifies callbacks.", "scope": "", "scopeKind": ""}, {"name": "void deviceDescriptorsUpdateWhitelist(const char * url)", "description": "Updates the whitelist URL, cancels existing update tasks, starts a new download task if necessary.", "scope": "", "scopeKind": ""}, {"name": "void deviceDescriptorsUpdateBlacklist(const char * url)", "description": "Updates the blacklist URL, cancels existing tasks, or removes local blacklist file if URL is invalid.", "scope": "", "scopeKind": ""}, {"name": "bool downloadFile(const char * url,const char * destFile,deviceDescriptorFileValidator fileValidator)", "description": "Downloads a file from a given URL to a destination path, validating its content if a validator is provided.", "scope": "", "scopeKind": ""}, {"name": "bool fileNeedsUpdating(const char * currentUrlSystemKey,const char * newUrl,const char * currentFilePath,const char * currentFileMd5SystemKey)", "description": "Determines if the target file needs to be downloaded based on URL change or MD5 mismatch.", "scope": "", "scopeKind": ""}, {"name": "char * getFileMd5(const char * path)", "description": "Computes and returns the MD5 checksum of a local file's contents.", "scope": "", "scopeKind": ""}, {"name": "void cancelBlacklistUpdate()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "void cancelWhitelistUpdate()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool updateBlacklistTaskFunc(void * taskArg)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool updateWhitelistTaskFunc(void * taskArg)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["deviceServiceSetSystemProperty", "deviceServiceGetSystemProperty", "hasProperty", "getPropertyAsString", "createBackOffRepeatingTask", "cancelRepeatingTask", "urlHelperCancel", "urlHelperDownloadFile", "doesFileExist", "readFileContents", "icMd5sum", "stringCompare"], "search-terms": ["deviceDescriptorHandler", "whitelist", "blacklist", "downloadFile", "MD5", "URL update", "scheduled retry", "file validation", "system properties", "createBackOffRepeatingTask"], "state": 2, "file_id": 983, "knowledge_revision": 14132, "git_revision": "", "ctags": [{"_type": "tag", "name": "CURRENT_BLACKLIST_MD5", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define CURRENT_BLACKLIST_MD5 /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "CURRENT_BLACKLIST_URL", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define CURRENT_BLACKLIST_URL /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "CURRENT_DEVICE_DESCRIPTOR_MD5", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define CURRENT_DEVICE_DESCRIPTOR_MD5 /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "CURRENT_DEVICE_DESCRIPTOR_URL", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define CURRENT_DEVICE_DESCRIPTOR_URL /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "DEFAULT_INVALID_BLACKLIST_URL", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define DEFAULT_INVALID_BLACKLIST_URL /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "DOWNLOAD_TIMEOUT_SECS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define DOWNLOAD_TIMEOUT_SECS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "INIT_DD_TASK_WAIT_TIME_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define INIT_DD_TASK_WAIT_TIME_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "INTERVAL_DD_TASK_TIME_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define INTERVAL_DD_TASK_TIME_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "LOG_TAG", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define LOG_TAG /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "MAX_DD_TASK_WAIT_TIME_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define MAX_DD_TASK_WAIT_TIME_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "MIN_URL_LENGTH", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^#define MIN_URL_LENGTH /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "blacklistTaskId", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static uint32_t blacklistTaskId = 0;$/", "file": true, "language": "C", "typeref": "typename:uint32_t", "kind": "variable"}, {"_type": "tag", "name": "cancelBlacklistUpdate", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static void cancelBlacklistUpdate()$/", "file": true, "language": "C", "typeref": "typename:void", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "cancelWhitelistUpdate", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static void cancelWhitelistUpdate()$/", "file": true, "language": "C", "typeref": "typename:void", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "currentBlacklistUrl", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static char *currentBlacklistUrl;$/", "file": true, "language": "C", "typeref": "typename:char *", "kind": "variable"}, {"_type": "tag", "name": "currentWhitelistUrl", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static char *currentWhitelistUrl;$/", "file": true, "language": "C", "typeref": "typename:char *", "kind": "variable"}, {"_type": "tag", "name": "descriptorsUpdatedCB", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static deviceDescriptorsUpdatedFunc descriptorsUpdatedCB;$/", "file": true, "language": "C", "typeref": "typename:deviceDescriptorsUpdatedFunc", "kind": "variable"}, {"_type": "tag", "name": "deviceDescriptorFileValidator", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^typedef bool (*deviceDescriptorFileValidator)(const char *path);$/", "file": true, "language": "C", "typeref": "typename:bool (*)(const char * path)", "kind": "typedef"}, {"_type": "tag", "name": "deviceDescriptorMutex", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static pthread_mutex_t deviceDescriptorMutex = PTHREAD_MUTEX_INITIALIZER;$/", "file": true, "language": "C", "typeref": "typename:pthread_mutex_t", "kind": "variable"}, {"_type": "tag", "name": "deviceDescriptorsUpdateBlacklist", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^void deviceDescriptorsUpdateBlacklist(const char *url)$/", "language": "C", "typeref": "typename:void", "kind": "function", "signature": "(const char * url)"}, {"_type": "tag", "name": "deviceDescriptorsUpdateWhitelist", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^void deviceDescriptorsUpdateWhitelist(const char *url)$/", "language": "C", "typeref": "typename:void", "kind": "function", "signature": "(const char * url)"}, {"_type": "tag", "name": "deviceServiceDeviceDescriptorsDestroy", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^void deviceServiceDeviceDescriptorsDestroy()$/", "language": "C", "typeref": "typename:void", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "deviceServiceDeviceDescriptorsInit", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^void deviceServiceDeviceDescriptorsInit(deviceDescriptorsReadyForDevicesFunc readyForDevicesCall/", "language": "C", "typeref": "typename:void", "kind": "function", "signature": "(deviceDescriptorsReadyForDevicesFunc readyForDevicesCallback,deviceDescriptorsUpdatedFunc descriptorsUpdatedCallback)"}, {"_type": "tag", "name": "downloadFile", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static bool downloadFile(const char *url, const char *destFile, deviceDescriptorFileValidator fi/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(const char * url,const char * destFile,deviceDescriptorFileValidator fileValidator)"}, {"_type": "tag", "name": "fileNeedsUpdating", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static bool fileNeedsUpdating(const char *currentUrlSystemKey,$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(const char * currentUrlSystemKey,const char * newUrl,const char * currentFilePath,const char * currentFileMd5SystemKey)"}, {"_type": "tag", "name": "getFileMd5", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static char* getFileMd5(const char* path)$/", "file": true, "language": "C", "typeref": "typename:char *", "kind": "function", "signature": "(const char * path)"}, {"_type": "tag", "name": "readyForDevicesCB", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static deviceDescriptorsReadyForDevicesFunc readyForDevicesCB;$/", "file": true, "language": "C", "typeref": "typename:deviceDescriptorsReadyForDevicesFunc", "kind": "variable"}, {"_type": "tag", "name": "updateBlacklistTaskFunc", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static bool updateBlacklistTaskFunc(void *taskArg)$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(void * taskArg)"}, {"_type": "tag", "name": "updateWhitelistTaskFunc", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static bool updateWhitelistTaskFunc(void *taskArg)$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(void * taskArg)"}, {"_type": "tag", "name": "whitelistTaskId", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "pattern": "/^static uint32_t whitelistTaskId = 0;$/", "file": true, "language": "C", "typeref": "typename:uint32_t", "kind": "variable"}], "hash": "39b52effba20926a9386b9442f749eb9", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "components/opensource/zilker-sdk/source/services/device/core/src/deviceDescriptorHandler.c", "fields": [{"name": "uint32_t blacklistTaskId", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "char * currentBlacklistUrl", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "char * currentWhitelistUrl", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "deviceDescriptorsUpdatedFunc descriptorsUpdatedCB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pthread_mutex_t deviceDescriptorMutex", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "deviceDescriptorsReadyForDevicesFunc readyForDevicesCB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "uint32_t whitelistTaskId", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"14132": ""}]}