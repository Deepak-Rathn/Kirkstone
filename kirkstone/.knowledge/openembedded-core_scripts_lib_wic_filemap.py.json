{"is_source_file": true, "format": "Python", "description": "This source file implements a Python module that provides an abstraction for obtaining file block mapping information using different methods: FIEMAP ioctl and SEEK_HOLE/SEEK_DATA. It defines classes for handling these methods, along with fallback classes for unsupported systems, and utility functions for copying sparse files efficiently.", "external_files": ["fcntl", "os", "struct", "array", "tempfile", "logging"], "external_methods": ["fcntl.ioctl", "os.fstat", "os.lseek", "os.fsync", "os.path.getsize"], "published": ["filemap", "ErrorNotSupp", "Error", "get_block_size", "sparse_copy"], "classes": [{"name": "ErrorNotSupp", "description": "Exception raised when FIEMAP or SEEK_HOLE/SEEK_DATA features are not supported."}, {"name": "Error", "description": "General exception class for errors from this module."}, {"name": "_FilemapBase", "description": "Base class providing common initialization for file mapping classes, handling file opening, size, block size, and logging."}, {"name": "FilemapSeek", "description": "Implements file block mapping using SEEK_HOLE and SEEK_DATA features of the filesystem."}, {"name": "FilemapFiemap", "description": "Implements file block mapping using the FIEMAP ioctl for detailed extent information."}, {"name": "FilemapNobmap", "description": "Fallback class indicating all blocks are mapped when no file mapping support is available."}], "methods": [{"name": "get_block_size(file_obj)", "description": "Returns the block size for a given file object, trying ioctl and fstat.", "scope": "", "scopeKind": ""}, {"name": "filemap(image, log=None)", "description": "Factory function that returns an appropriate file mapping class instance based on system support.", "scope": "", "scopeKind": ""}, {"name": "sparse_copy(src_fname, dst_fname, skip=0, seek=0, length=0, api=None)", "description": "Copies sparse files efficiently by copying only the mapped extents.", "scope": "", "scopeKind": ""}, {"name": "__del__(self)", "scope": "_FilemapBase", "scopeKind": "class", "description": "unavailable"}, {"name": "__init__(self, image, log=None)", "scope": "_FilemapBase", "scopeKind": "class", "description": "unavailable"}, {"name": "_do_get_mapped_ranges(self, start, count)", "scope": "FilemapFiemap", "scopeKind": "class", "description": "unavailable"}, {"name": "_get_ranges(self, start, count, whence1, whence2)", "scope": "FilemapSeek", "scopeKind": "class", "description": "unavailable"}, {"name": "_invoke_fiemap(self, block, count)", "scope": "FilemapFiemap", "scopeKind": "class", "description": "unavailable"}, {"name": "_lseek(file_obj, offset, whence)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_open_image_file(self)", "scope": "_FilemapBase", "scopeKind": "class", "description": "unavailable"}, {"name": "_probe_seek_hole(self)", "scope": "FilemapSeek", "scopeKind": "class", "description": "unavailable"}, {"name": "_unpack_fiemap_extent(self, index)", "scope": "FilemapFiemap", "scopeKind": "class", "description": "unavailable"}, {"name": "block_is_mapped(self, block)", "scope": "FilemapSeek", "scopeKind": "class", "description": "unavailable"}, {"name": "get_mapped_ranges(self, start, count)", "scope": "FilemapSeek", "scopeKind": "class", "description": "unavailable"}], "calls": ["fcntl.ioctl", "os.fstat", "os.lseek", "os.fsync", "os.path.getsize", "os.ftruncate", "os.path.dirname", "os.path.getsize"], "search-terms": ["filemap", "FIEMAP", "SEEK_HOLE", "SEEK_DATA", "sparse_copy", "block size", "extent mapping", "file copying", "file system support", "Linux ioctl"], "state": 2, "file_id": 1456, "knowledge_revision": 14606, "git_revision": "", "ctags": [{"_type": "tag", "name": "Error", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class Error(Exception):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ErrorNotSupp", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class ErrorNotSupp(Exception):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "FilemapFiemap", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class FilemapFiemap(_FilemapBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "FilemapNobmap", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class FilemapNobmap(_FilemapBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "FilemapSeek", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class FilemapSeek(_FilemapBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_FIEMAP_BUFFER_SIZE", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_BUFFER_SIZE = 256 * 1024$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_EXTENT_FORMAT", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_EXTENT_FORMAT = \"=QQQQQLLLL\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_EXTENT_SIZE", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_EXTENT_SIZE = struct.calcsize(_FIEMAP_EXTENT_FORMAT)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_FLAG_SYNC", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_FLAG_SYNC = 0x00000001$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_FORMAT", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_FORMAT = \"=QQLLLL\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_IOCTL", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_IOCTL = 0xC020660B$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FIEMAP_SIZE", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_FIEMAP_SIZE = struct.calcsize(_FIEMAP_FORMAT)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_FilemapBase", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^class _FilemapBase(object):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_SEEK_DATA", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_SEEK_DATA = 3$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_SEEK_HOLE", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^_SEEK_HOLE = 4$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "__del__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def __del__(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "_FilemapBase", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def __init__(self, image, log=None):$/", "language": "Python", "kind": "member", "signature": "(self, image, log=None)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def __init__(self, image, log=None):$/", "language": "Python", "kind": "member", "signature": "(self, image, log=None)", "scope": "FilemapNobmap", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def __init__(self, image, log=None):$/", "language": "Python", "kind": "member", "signature": "(self, image, log=None)", "scope": "FilemapSeek", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def __init__(self, image, log=None):$/", "language": "Python", "kind": "member", "signature": "(self, image, log=None)", "scope": "_FilemapBase", "scopeKind": "class"}, {"_type": "tag", "name": "_do_get_mapped_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _do_get_mapped_ranges(self, start, count):$/", "language": "Python", "kind": "member", "signature": "(self, start, count)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "_get_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _get_ranges(self, start, count, whence1, whence2):$/", "language": "Python", "kind": "member", "signature": "(self, start, count, whence1, whence2)", "scope": "FilemapSeek", "scopeKind": "class"}, {"_type": "tag", "name": "_invoke_fiemap", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _invoke_fiemap(self, block, count):$/", "language": "Python", "kind": "member", "signature": "(self, block, count)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "_lseek", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^def _lseek(file_obj, offset, whence):$/", "language": "Python", "kind": "function", "signature": "(file_obj, offset, whence)"}, {"_type": "tag", "name": "_open_image_file", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _open_image_file(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "_FilemapBase", "scopeKind": "class"}, {"_type": "tag", "name": "_probe_seek_hole", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _probe_seek_hole(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "FilemapSeek", "scopeKind": "class"}, {"_type": "tag", "name": "_unpack_fiemap_extent", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def _unpack_fiemap_extent(self, index):$/", "language": "Python", "kind": "member", "signature": "(self, index)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "block_is_mapped", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def block_is_mapped(self, block): # pylint: disable=W0613,R0201$/", "language": "Python", "kind": "member", "signature": "(self, block)", "scope": "_FilemapBase", "scopeKind": "class"}, {"_type": "tag", "name": "block_is_mapped", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def block_is_mapped(self, block):$/", "language": "Python", "kind": "member", "signature": "(self, block)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "block_is_mapped", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def block_is_mapped(self, block):$/", "language": "Python", "kind": "member", "signature": "(self, block)", "scope": "FilemapNobmap", "scopeKind": "class"}, {"_type": "tag", "name": "block_is_mapped", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def block_is_mapped(self, block):$/", "language": "Python", "kind": "member", "signature": "(self, block)", "scope": "FilemapSeek", "scopeKind": "class"}, {"_type": "tag", "name": "filemap", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^def filemap(image, log=None):$/", "language": "Python", "kind": "function", "signature": "(image, log=None)"}, {"_type": "tag", "name": "get_block_size", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^def get_block_size(file_obj):$/", "language": "Python", "kind": "function", "signature": "(file_obj)"}, {"_type": "tag", "name": "get_mapped_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def get_mapped_ranges(self, start, count): # pylint: disable=W0613,R0201$/", "language": "Python", "kind": "member", "signature": "(self, start, count)", "scope": "_FilemapBase", "scopeKind": "class"}, {"_type": "tag", "name": "get_mapped_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def get_mapped_ranges(self, start, count):$/", "language": "Python", "kind": "member", "signature": "(self, start, count)", "scope": "FilemapFiemap", "scopeKind": "class"}, {"_type": "tag", "name": "get_mapped_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def get_mapped_ranges(self, start, count):$/", "language": "Python", "kind": "member", "signature": "(self, start, count)", "scope": "FilemapNobmap", "scopeKind": "class"}, {"_type": "tag", "name": "get_mapped_ranges", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^    def get_mapped_ranges(self, start, count):$/", "language": "Python", "kind": "member", "signature": "(self, start, count)", "scope": "FilemapSeek", "scopeKind": "class"}, {"_type": "tag", "name": "sparse_copy", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/openembedded-core/scripts/lib/wic/filemap.py", "pattern": "/^def sparse_copy(src_fname, dst_fname, skip=0, seek=0,$/", "language": "Python", "kind": "function", "signature": "(src_fname, dst_fname, skip=0, seek=0, length=0, api=None)"}], "hash": "822abe93da864c0b00d222d572ca617e", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "openembedded-core/scripts/lib/wic/filemap.py", "fields": [{"name": "_FIEMAP_BUFFER_SIZE = 256 * 1024", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_EXTENT_FORMAT = \"=QQQQQLLLL\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_EXTENT_SIZE = struct.calcsize(_FIEMAP_EXTENT_FORMAT)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_FLAG_SYNC = 0x00000001", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_FORMAT = \"=QQLLLL\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_IOCTL = 0xC020660B", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_FIEMAP_SIZE = struct.calcsize(_FIEMAP_FORMAT)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_SEEK_DATA = 3", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_SEEK_HOLE = 4", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"14606": ""}]}