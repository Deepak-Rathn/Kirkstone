{"is_source_file": true, "format": "shell script / bash script", "description": "This file is a shell script used for self-healing, configuration management, and recovery tasks on a network device. It contains various functions to monitor and restart services such as DHCP clients, DHCPv6, dnsmasq, dibbler, dropbear, and to ensure network interfaces are correctly configured and operational. The script also handles device-specific configurations based on model and manufacturer.", "external_files": ["/etc/utopia/service.d/event_handler_functions.sh", "/etc/dibbler/server.conf", "/etc/utopia/service.d/service_sshd.sh", "/etc/udhcpc.script", "/lib/libert_dhcpv4_plugin.so", "/lib/rdk/dibbler-init.sh"], "external_methods": ["syscfg get", "sysevent get/set", "ps w", "ps ww", "busybox pidof", "ip addr show", "ip route show", "netstat -tulpn", "ip -6 addr show", "ip -6 addr show dev", "ifconfig", "ip link set dev down/up", "kill", "rm -f", "touch", "logNetworkInfo", "rebootNeeded", "getWanInterfaceName", "t2CountNotify", "logNetworkInfo", "systemctl", "cat /proc/$PID/cmdline", "grep"], "published": ["echo_t", "rebootNeeded", "getWanInterfaceName", "t2CountNotify"], "classes": [], "methods": [{"name": "Dhcpv6_Client_restart", "description": "Restarts the DHCPv6 client service based on parameters, handling different services like dibbler-client or ti_dhcp6c."}, {"name": "self_heal_process", "description": "Checks for specific RPC communication errors and restarts the CcspCMAgentSsp service if needed."}, {"name": "self_heal_peer_ping", "description": "Performs peer reachability tests via ping and arping, rebooting the device if the peer is unreachable multiple times."}, {"name": "self_heal_dnsmasq", "description": "Checks if dnsmasq is running and restarts it if it has crashed or zombie instances are detected."}, {"name": "self_heal_dnsmasq_restart", "description": "Restarts the dnsmasq process and related services based on platform specifics."}, {"name": "self_heal_dnsmasq_zombie", "description": "Detects zombie dnsmasq processes and restarts dnsmasq accordingly."}, {"name": "self_heal_interfaces", "description": "Main self-healing routine to verify and recreate network interfaces, VLANs, and related network components depending on device mode and manufacturer. Also handles interface recovery, Ethernet WAN port recovery, and device reboot if interfaces are not operational."}, {"name": "self_heal_dibbler_server", "description": "Monitors and restarts the dibbler IPv6 DHCP server based on various conditions including server configuration and IPv6 address presence."}, {"name": "self_heal_dhcp_clients", "description": "Verifies DHCP clients for IPv4 and IPv6 are running correctly, restarting them as needed, and handling DHCP renewal in case of failures."}, {"name": "self_heal_dropbear", "description": "Ensures the dropbear SSH server is running and correctly listening on IPv4 and IPv6 addresses; restarts it if it is not."}, {"name": "self_heal_process", "description": "Main self-healing routine invoked for specific device models, performing process and service checks."}, {"name": "self_heal_peer_ping", "description": "Performs peer reachability tests via ping and arping, rebooting the device if peer is unreachable multiple times."}, {"name": "self_heal_dnsmasq", "description": "Checks dnsmasq process health and restarts it if crashed or zombie processes are detected."}, {"name": "self_heal_dnsmasq_restart", "description": "Restarts dnsmasq and related services based on platform-specific conditions."}, {"name": "self_heal_dnsmasq_zombie", "description": "Detects zombie dnsmasq processes and triggers restart procedures."}, {"name": "self_heal_interfaces", "description": "Verifies and maintains network interfaces, VLANs, and related network configurations, including device reboot if interfaces are not operational."}, {"name": "self_heal_dibbler_server", "description": "Monitors and restarts the IPv6 DHCP server (dibbler) as needed."}, {"name": "self_heal_dhcp_clients", "description": "Verifies DHCP clients for IPv4 and IPv6 and restarts as necessary."}, {"name": "self_heal_dropbear", "description": "Ensures the dropbear SSH server is running and listening on expected interfaces, restarting if not."}, {"name": "self_heal_ccspwifissp_hung", "description": "Checks for WiFi process hang conditions and restarts WiFi services if hung."}, {"name": "self_heal_nas_ip", "description": "Repairs the NAS IP address in hostapd configurations when it is set to loopback IPs."}, {"name": "self_heal_dhcpmgr", "description": "Restarts the DHCP manager service if it is not running."}, {"name": "wan_sysevents", "description": "Triggers WAN restart and status update via sysevent."}, {"name": "self_heal_wan", "description": "Monitors and takes corrective action if WAN status appears stuck."}, {"name": "self_heal_sedaemon", "description": "Restarts specific system daemon processes required for certain device models."}], "calls": ["systemctl status CcspCMAgentSsp.service", "sysevent get/set", "ps w", "ps ww", "busybox pidof", "ip addr show", "ip route show", "netstat -tulpn", "ip -6 addr show", "ifconfig", "kill", "rm -f", "touch", "sleep", "logNetworkInfo", "rebootNeeded", "getWanInterfaceName", "t2CountNotify", "sysevent set lan-start", "sysevent set lan_selfheal", "sysevent get", "syscfg get", "syscfg show", "syscfg set", "syscfg commit", "logNetworkInfo", "dibbler-server start/stop", "dibbler-client start/stop", "systemctl restart", "cat /proc/$PID/cmdline", "grep"], "search-terms": ["selfheal", "Dibbler", "DHCPv6", "dropbear", "dnsmasq", "interfaces", "reboot", "eth_wan_enabled", "wan-interface", "IPv6", "VLAN", "self-healing", "service_restart", "network interfaces"], "state": 2, "file_id": 9095, "knowledge_revision": 22134, "git_revision": "", "hash": "600dac72cd28d55ca49847e157eb3e13", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "rdkb/components/opensource/ccsp/TestAndDiagnostic/scripts/selfheal_aggressive.sh", "revision_history": [{"22134": ""}]}