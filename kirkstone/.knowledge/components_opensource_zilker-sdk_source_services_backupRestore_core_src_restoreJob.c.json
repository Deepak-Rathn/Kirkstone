{"is_source_file": true, "format": "C", "description": "This file implements the core functionality for a restore job in a configuration management system. It handles starting the restore process, executing scripts, notifying services, waiting for callbacks and restarts, and cleaning up resources. The code includes thread management, IPC communication with services, and event broadcasting during different restore steps.", "external_files": ["icBuildtime.h", "icLog/logging.h", "icConcurrent/delayedTask.h", "icIpc/ipcReceiver.h", "icIpc/ipcStockMessages.h", "icConfig/storage.h", "watchdog/watchdogService_pojo.h", "watchdog/watchdogService_ipc.h", "propsMgr/paths.h", "commMgr/commService_ipc.h", "backup/backupRestoreService_event.h", "urlHelper/urlHelper.h", "icUtil/fileUtils.h", "icUtil/stringUtils.h", "icConcurrent/timedWait.h", "icConcurrent/threadUtils.h", "restoreJob.h", "common.h", "broadcastEvent.h"], "external_methods": ["urlHelperDownloadFile", "getSslVerifyProperty", "system", "mkdtemp", "chmod", "sleep", "strdup", "linkedListAppend", "linkedListClear", "linkedListCreate", "createDetachedThread", "strcpy", "strcat", "unlink", "deleteDirectory", "doesDirExist", "getStaticPath", "getDynamicConfigPath", "broadcastRestoreEvent", "watchdogService_request_STOP_SERVICE_timeout", "watchdogService_request_START_SERVICE_timeout", "create_allServiceNames", "watchdogService_request_GET_ALL_SERVICE_NAMES", "create_configRestoredInput", "create_processInfo", "watchdogService_request_GET_SERVICE_BY_NAME", "configRestored", "create_configRestoredOutput", "destroy_processInfo", "destroy_configRestoredInput", "destroy_configRestoredOutput", "destroy_allServiceNames", "linkedListIteratorCreate", "linkedListIteratorHasNext", "linkedListIteratorGetNext", "linkedListIteratorDestroy", "linkedListCount", "linkedListDelete", "linkedList", "linkedListCreate"], "published": ["isRestoreRunning", "startRestoreProcess", "notifyRestoreCallback"], "classes": [], "methods": [{"name": "bool isRestoreRunning()", "description": "Checks if a restore process is currently in progress by examining a protected static flag.", "scope": "", "scopeKind": ""}, {"name": "bool startRestoreProcess(icLinkedList * steps)", "description": "Initiates the restore process if no restore is currently running. It sets up steps, launches the restore thread, and manages mutex locking.", "scope": "", "scopeKind": ""}, {"name": "void notifyRestoreCallback(restoreCallbackInfo * input)", "description": "Handles callback notifications from services indicating restore status, updating callback and restart lists accordingly.", "scope": "", "scopeKind": ""}, {"name": "char * extractConfig()", "description": "Executes a script to extract configuration files, creating a temporary directory, downloading the config archive, and running the restore script.", "scope": "", "scopeKind": ""}, {"name": "void * restoreThread(void * arg)", "description": "Performs the sequence of steps necessary to perform a restore, including downloading config, informing services, waiting for responses, cleanup, and signaling completion.", "scope": "", "scopeKind": ""}, {"name": "bool waitForServiceCallbacks(void)", "description": "Waits for all registered services to call back with restore status, with a timeout for each wait.", "scope": "", "scopeKind": ""}, {"name": "bool waitForServiceRestarts(void)", "description": "Stops services, restarts them, and confirms restart success, based on the restart list.", "scope": "", "scopeKind": ""}, {"name": "bool tellAllServices(char * restoreDir,char * configDir)", "description": "Informs all registered services of the restore directory and manages their responses, including adding services to callback or restart lists as needed.", "scope": "", "scopeKind": ""}], "calls": ["urlHelperDownloadFile", "system", "mkdtemp", "chmod", "sleep", "strdup", "linkedListAppend", "linkedListClear", "createDetachedThread", "getStaticPath", "getDynamicConfigPath", "broadcastRestoreEvent", "watchdogService_request_STOP_SERVICE_timeout", "watchdogService_request_START_SERVICE_timeout", "create_allServiceNames", "watchdogService_request_GET_ALL_SERVICE_NAMES", "create_configRestoredInput", "watchdogService_request_GET_SERVICE_BY_NAME", "configRestored", "create_configRestoredOutput", "destroy_processInfo", "destroy_configRestoredInput", "destroy_configRestoredOutput", "destroy_allServiceNames", "linkedListIteratorCreate", "linkedListIteratorHasNext", "linkedListIteratorGetNext", "linkedListIteratorDestroy", "deleteDirectory"], "search-terms": ["restoreJob", "restore process", "service callbacks", "service restart list", "config extraction", "restore steps", "IPC restore notification", "temp restore directory", "download restore config", "restore thread", "watchdog service"], "state": 2, "file_id": 1203, "knowledge_revision": 14362, "git_revision": "", "ctags": [{"_type": "tag", "name": "CONFIG_DOWNLOAD_TIMEOUT_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define CONFIG_DOWNLOAD_TIMEOUT_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "RESTORE_MTX", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static pthread_mutex_t RESTORE_MTX = PTHREAD_MUTEX_INITIALIZER;$/", "file": true, "language": "C", "typeref": "typename:pthread_mutex_t", "kind": "variable"}, {"_type": "tag", "name": "RESTORE_STEP_BEGIN_STR", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define RESTORE_STEP_BEGIN_STR /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "RESTORE_STEP_COMPLETE_STR", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define RESTORE_STEP_COMPLETE_STR /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "RESTORE_STEP_CONFIG_STR", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define RESTORE_STEP_CONFIG_STR /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "RESTORE_STEP_DOWNLOAD_STR", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define RESTORE_STEP_DOWNLOAD_STR /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "RESTORE_STEP_NETWORK_STR", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define RESTORE_STEP_NETWORK_STR /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "SERVICE_RESTART_TIMEOUT_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define SERVICE_RESTART_TIMEOUT_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "SERVICE_RESTORE_COND", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static pthread_cond_t SERVICE_RESTORE_COND;$/", "file": true, "language": "C", "typeref": "typename:pthread_cond_t", "kind": "variable"}, {"_type": "tag", "name": "SERVICE_STOP_TIMEOUT_SECONDS", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define SERVICE_STOP_TIMEOUT_SECONDS /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "TAG", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^#define TAG /", "file": true, "language": "C", "kind": "macro"}, {"_type": "tag", "name": "extractConfig", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static char *extractConfig()$/", "file": true, "language": "C", "typeref": "typename:char *", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "isRestoreRunning", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^bool isRestoreRunning()$/", "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "notifyRestoreCallback", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^void notifyRestoreCallback(restoreCallbackInfo *input)$/", "language": "C", "typeref": "typename:void", "kind": "function", "signature": "(restoreCallbackInfo * input)"}, {"_type": "tag", "name": "restoreRunning", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static bool restoreRunning = false;$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "variable"}, {"_type": "tag", "name": "restoreThread", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static void *restoreThread(void *arg)$/", "file": true, "language": "C", "typeref": "typename:void *", "kind": "function", "signature": "(void * arg)"}, {"_type": "tag", "name": "serviceCallbackList", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static icLinkedList* serviceCallbackList = NULL;$/", "file": true, "language": "C", "typeref": "typename:icLinkedList *", "kind": "variable"}, {"_type": "tag", "name": "serviceRestartList", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static icLinkedList* serviceRestartList = NULL;$/", "file": true, "language": "C", "typeref": "typename:icLinkedList *", "kind": "variable"}, {"_type": "tag", "name": "startRestoreProcess", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^bool startRestoreProcess(icLinkedList *steps)$/", "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(icLinkedList * steps)"}, {"_type": "tag", "name": "tellAllServices", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static bool tellAllServices(char* restoreDir, char* configDir)$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(char * restoreDir,char * configDir)"}, {"_type": "tag", "name": "waitForServiceCallbacks", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static bool waitForServiceCallbacks(void)$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(void)"}, {"_type": "tag", "name": "waitForServiceRestarts", "path": "/home/kavia/workspace/code-generation/Kirkstone/kirkstone/components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "pattern": "/^static bool waitForServiceRestarts(void)$/", "file": true, "language": "C", "typeref": "typename:bool", "kind": "function", "signature": "(void)"}], "hash": "16e41a9b94e4a0a0915c38573bcf4b6b", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "components/opensource/zilker-sdk/source/services/backupRestore/core/src/restoreJob.c", "fields": [{"name": "pthread_mutex_t RESTORE_MTX", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pthread_cond_t SERVICE_RESTORE_COND", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool restoreRunning", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "icLinkedList * serviceCallbackList", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "icLinkedList * serviceRestartList", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"14362": ""}]}