{"is_source_file": true, "format": "shell script / sh", "description": "This file is a shell script used for firmware download and management on embedded devices. It handles connection setup, firmware retrieval, version checks, and reboot logic, specifically in the context of XConf firmware update process. The script includes multiple external source references, configuration logic, download procedures, and reboot management, indicating its role in device firmware management.", "external_files": ["/etc/utopia/service.d/log_capture_path.sh", "/fss/gw/etc/utopia/service.d/log_env_var.sh", "/lib/rdk/getpartnerid.sh", "/lib/rdk/getaccountid.sh", "/lib/rdk/t2Shared_api.sh", "/etc/waninfo.sh", "/lib/rdk/stateRedRecoveryUtils.sh", "/lib/rdk/mtlsUtils.sh", "/etc/device.properties", "/etc/bundleUtils.sh", "/lib/rdk/exec_curl_mtls.sh", "/etc/rdm/rdmBundleMgr.sh"], "external_methods": ["getPartnerId", "getAccountId", "getWanInterfaceName", "getWanMacInterfaceName", "syscfg get PeriodicFWCheck_Enable", "syscfg get wanlinkheal", "dmcli eRT getv Device.DeviceInfo.X_RDKCENTRAL-COM_RFC.Feature.CodeBigFirst.Enable", "dmcli eRT getv Device.DeviceInfo.X_RDKCENTRAL-COM_Syndication.XconfURL", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_FirmwareDownloadURL", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_FirmwareToDownload", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_xOpsDeviceMgmt.RPC.FirmwareDownloadStartedNotification", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_xOpsDeviceMgmt.RPC.FirmwareDownloadCompletedNotification", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_LastRebootReason"], "published": ["getCurrentFw", "getRequestType", "checkFirmwareUpgCriteria", "IsCodebigBlocked", "get_Codebigconfig", "do_Codebig_signing", "useDirectRequest", "useCodebigRequest", "getFirmwareUpgDetail", "fetchFirmwareDetail", "calcRandTime", "getMacAddress", "getBuildType", "removeLegacyResources", "checkMaintenanceWindow"], "classes": [], "methods": [{"name": "getCurrentFw", "description": "Retrieves current firmware version from version.txt or version files."}, {"name": "getRequestType", "description": "Determines request type based on domain name."}, {"name": "checkFirmwareUpgCriteria", "description": "Checks if the current firmware is different from the requested firmware, indicating availability for upgrade."}, {"name": "IsCodebigBlocked", "description": "Checks if Codebig is currently blocked due to previous failures within a timeout window."}, {"name": "get_Codebigconfig", "description": "Retrieves and configures whether to use Codebig or direct connection based on configuration files and flags."}, {"name": "do_Codebig_signing", "description": "Signs requests for Codebig using external configuration and prepares headers for secure communication."}, {"name": "useDirectRequest", "description": "Attempts to perform a firmware request directly via configured interfaces and certificates."}, {"name": "useCodebigRequest", "description": "Attempt to perform a firmware request via Codebig service, considering block status."}, {"name": "getFirmwareUpgDetail", "description": "Contacts XConf server to check for available firmware updates, handles response parsing, and manages retry logic."}, {"name": "fetchFirmwareDetail", "description": "Loads stored firmware download details from previous response files."}, {"name": "calcRandTime", "description": "Calculates random times within specified maintenance windows for scheduled checks or reboots."}, {"name": "getMacAddress", "description": "Retrieves the MAC address of the WAN interface."}, {"name": "getBuildType", "description": "Determines device build type based on version.txt."}, {"name": "removeLegacyResources", "description": "Removes old or legacy resources and logs to prepare for current execution."}, {"name": "checkMaintenanceWindow", "description": "Checks if current time falls within predefined maintenance windows for reboot or update scheduling."}], "calls": ["getPartnerId", "getAccountId", "getWanInterfaceName", "dmcli eRT getv Device.DeviceInfo.X_RDKCENTRAL-COM_RFC.Feature.CodeBigFirst.Enable", "dmcli eRT getv Device.DeviceInfo.X_RDKCENTRAL-COM_Syndication.XconfURL", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_FirmwareDownloadURL", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_FirmwareToDownload", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_xOpsDeviceMgmt.RPC.FirmwareDownloadStartedNotification", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_xOpsDeviceMgmt.RPC.FirmwareDownloadCompletedNotification", "dmcli eRT setv Device.DeviceInfo.X_RDKCENTRAL-COM_LastRebootReason", "syscfg get PeriodicFWCheck_Enable", "syscfg get wanlinkheal", "ifconfig", "grep", "sed", "date", "sleep", "touch", "rm -f", "cat", "echo", "awk", "tr", "cut", "eval", "result", "result= eval", "oneshot", "sed -i", "expr", "crontab", "sh", "chmod"], "search-terms": ["XConf", "FirmwareDownload", "RebootManager", "Codebig", "Firmware Upgrade", "Maintenance Window", "Firmware Version", "Firmware URL", "firmwareDownloadProtocol", "FirmwareDownloadURL", "Factory Reset", "delayedDownload", "FirmwareUpdateCheck", "FirmwareDownload", "FirmwareUpgrade", "FirmwareDownloadStatus", "FirmwareDownloadNotification"], "state": 2, "file_id": 8164, "knowledge_revision": 21225, "git_revision": "", "hash": "12afa74ed055d1b55bd646fa64e2f894", "format-version": 4, "code-base-name": "meta-rdk-sampleapp", "filename": "rdkb/components/opensource/ccsp/Xconf/scripts/cbr_firmwareDwnld.sh", "revision_history": [{"21225": ""}]}